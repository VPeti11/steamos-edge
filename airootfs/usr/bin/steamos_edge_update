#!/bin/bash
#  SPDX-License-Identifier: LGPL-2.1+
#
#  Copyright Â© 2025 EdgeDev.
#
#  This file is part of SteamOS Edge.
#
#  steamos-edge is free software; you can redistribute it and/or
#  modify it under the terms of the GNU Lesser General Public License as
#  published by the Free Software Foundation; either version 2.1 of the License,
#  or (at your option) any later version.

if [[ $EUID -ne 0 ]]; then
    echo "This script must be run as root. Use sudo!"
    exit 1
fi
mkdir -p /tmp/updating/
cd /tmp/updating/
arch=$(uname -m)
if [[ "$arch" == "x86_64" ]]; then
    echo "64-bit architecture detected"
    wget https://gitlab.com/edgedev1/steamos-edge/-/raw/main/mkedge/packages.x86_64.base
    pacman -Syu $(cat packages.x86_64) --needed --noconfirm
elif [[ "$arch" == "i686" || "$arch" == "i386" ]]; then
    echo "32-bit architecture detected"
    wget https://gitlab.com/edgedev1/steamos-edge/-/raw/main/mkedge/packages.i686.base
    pacman -Syu $(cat packages.i686) --needed --noconfirm
else
    echo "Unknown architecture: $arch"
fi

# Thanks Quota!
# https://discord.com/channels/1338559346853810238/1338559346853810241/1338995791443918908
pacman -Syu
echo "Installed packages"
cd /
rm -rf /tmp/updating/